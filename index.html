<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TullunPrint - Product Mockup Generator</title>
    <style>
        :root {
            --primary-color: #0071e3;
            --primary-hover: #0077ed;
            --text-color: #1d1d1f;
            --light-text: #86868b;
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 16px rgba(0, 0, 0, 0.12);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.5;
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            padding: 20px 0;
            background-color: var(--card-bg);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.05);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .logo:hover {
            opacity: 0.8;
        }
        
        /* Hero Section */
        .hero {
            text-align: center;
            padding: 60px 0 40px;
        }
        
        .hero h1 {
            font-size: 48px;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }
        
        .hero p {
            font-size: 24px;
            color: var(--light-text);
            max-width: 700px;
            margin: 0 auto 40px;
        }
        
        /* Product Category Selection */
        .product-category-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 40px;
        }
        
        .product-category-link {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 500;
            font-size: 17px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 113, 227, 0.2);
        }
        
        .product-category-link:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }
        
        .product-category-link.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Product Type Selection */
        .product-type-container {
            display: none; /* Hidden by default */
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 30px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .product-type-link {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--card-bg);
            border-radius: 20px;
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            font-size: 15px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        .product-type-link:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-1px);
        }
        
        .product-type-link.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Color and Size Selection */
        .color-size-container {
            display: none;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            margin: 20px auto;
            max-width: 600px;
        }
        
        .color-option, .size-option, .stand-option {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            background-color: var(--card-bg);
            border-radius: 20px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
        
        .color-option:hover, .size-option:hover, .stand-option:hover {
            box-shadow: var(--shadow-hover);
        }
        
        .color-option.active, .size-option.active, .stand-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Color preview circles */
        .color-preview {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        /* Controls Section */
        #controls {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 24px;
            margin: 0 auto 40px;
            max-width: 800px;
            display: none; /* Hidden by default */
            animation: fadeIn 0.3s ease-out;
        }
        
        .controls-row {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .file-upload-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .file-upload-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-upload-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: 500;
            font-size: 15px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .file-upload-btn:hover {
            background-color: var(--primary-hover);
            box-shadow: var(--shadow-hover);
            transform: translateY(-1px);
        }
        
        #remove-btn {
            position: absolute;
            right: -8px;
            top: -8px;
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            padding: 0;
            cursor: pointer;
            font-size: 12px;
            line-height: 24px;
            display: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        
        #remove-btn:hover {
            transform: scale(1.1);
        }
        
        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: 500;
            font-size: 15px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        button:hover {
            background-color: var(--primary-hover);
            box-shadow: var(--shadow-hover);
            transform: translateY(-1px);
        }
        
        button:disabled {
            background-color: #d2d2d7;
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--shadow);
        }
        
        /* Upload requirements */
        .upload-requirements {
            font-size: 14px;
            color: var(--light-text);
            margin-top: 8px;
            text-align: center;
            width: 100%;
        }

        /* Mockup Container */
        #main-mockup-container {
            position: relative;
            display: inline-block; /* Changed from inline-block to block */
            margin: 20px auto; /* This centers the container horizontally */
            width: 600px;
            height: 600px;
            overflow: hidden;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: none; /* Hidden by default */
            animation: fadeIn 0.3s ease-out;
        }
        
        .phone-case-bg, .phone-case-overlay, .tshirt-bg, .bag-bg, .plaque-bg, .airpods-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: auto;
        }
        
        .phone-case-bg, .tshirt-bg, .bag-bg, .plaque-bg, .airpods-bg {
            z-index: 1;
        }
        
        .design-area {
            position: absolute;
            z-index: 2;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .user-design {
            position: absolute;
            max-width: 100%;
            max-height: 100%;
            top: 48.5%;
            left: 48.5%;
            transform: translate(-50%, -50%);
            object-fit: contain;
            display: none;
        }
        
        .phone-case-overlay, .tshirt-overlay, .bag-overlay, .plaque-overlay, .airpods-overlay {
            z-index: 3;
            pointer-events: none;
        }
        
        /* Grid View */
        .grid-wrapper {
            max-width: 1600px;
            margin: 40px auto;
            padding: 0 20px;
            display: none; /* Hidden by default */
            animation: fadeIn 0.3s ease-out;
        }
        
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 24px;
            margin: 0 auto;
        }
        
        .grid-item {
            position: relative;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .grid-item:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-4px);
        }
        
        .grid-item .secondary-mockup {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 100%;
        }
        
        .grid-item .phone-case-bg,
        .grid-item .phone-case-overlay,
        .grid-item .design-area,
        .grid-item .tshirt-bg,
        .grid-item .tshirt-overlay,
        .grid-item .bag-bg,
        .grid-item .bag-overlay,
        .grid-item .plaque-bg,
        .grid-item .plaque-overlay,
        .grid-item .airpods-bg,
        .grid-item .airpods-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .grid-item .design-area {
            z-index: 2;
        }
        
        .grid-item .phone-case-overlay,
        .grid-item .tshirt-overlay,
        .grid-item .bag-overlay,
        .grid-item .plaque-overlay,
        .grid-item .airpods-overlay {
            z-index: 3;
        }
        
        .grid-item .carousel-checkbox {
            position: absolute;
            top: 12px;
            left: 12px;
            z-index: 4;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .mockup-label {
            padding: 16px;
            font-size: 15px;
            color: var(--text-color);
            text-align: center;
        }
        
        /* Coming Soon Sections */
        .coming-soon {
            text-align: center;
            padding: 60px 20px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 40px;
        }
        
        .coming-soon h2 {
            font-size: 32px;
            margin-bottom: 16px;
        }
        
        .coming-soon p {
            font-size: 18px;
            color: var(--light-text);
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Loading Overlay */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.2em;
            flex-direction: column;
            font-weight: 400;
        }
        
        .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 36px;
            }
            
            .hero p {
                font-size: 20px;
            }
            
            #main-mockup-container {
                width: 100%;
                height: auto;
                max-width: 400px;
            }
            
            .grid-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .hero h1 {
                font-size: 28px;
            }
            
            .hero p {
                font-size: 18px;
            }
            
            .product-category-link {
                padding: 10px 16px;
                font-size: 15px;
            }
            
            .product-type-link {
                padding: 8px 14px;
                font-size: 14px;
            }
            
            button, .file-upload-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            .coming-soon h2 {
                font-size: 24px;
            }
            
            .coming-soon p {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="https://tullunmockup.github.io/TULLUN/" class="logo">TullunPrint</a>
        </div>
    </header>
    
    <main class="container">
        <section class="hero">
            <h1>Product Mockup Generator</h1>
            <p>Upload your design to see it on our premium products</p>
            
            <!-- Product Category Selection -->
            <div class="product-category-container">
                <a href="#" class="product-category-link" data-category="phone-cases">Phone Cases</a>
                <a href="#" class="product-category-link" data-category="plaques">Plaques</a>
                <a href="#" class="product-category-link" data-category="airpods-cases">AirPods Cases</a>
                <a href="#" class="product-category-link" data-category="tshirts">T-Shirts</a>
                <a href="#" class="product-category-link" data-category="bags">Bags</a>
            </div>
            
            <!-- Product Type Selection (initially hidden) -->
            <div id="phone-cases-types" class="product-type-container">
                <a href="#" class="product-type-link" data-case="samsung-tpu">Samsung TPU Case</a>
                <a href="#" class="product-type-link" data-case="iphone-tpu">iPhone TPU Case</a>
                <a href="#" class="product-type-link" data-case="iphone-hybrid">iPhone Hybrid Case</a>
                <a href="#" class="product-type-link" data-case="pixel-tpu">Google Pixel TPU Case</a>
                <a href="#" class="product-type-link" data-case="iphone-fullprint">iPhone Fullprint Case</a>
            </div>

            <!-- Plaques Type Selection -->
            <div id="plaques-types" class="product-type-container">
                <a href="#" class="product-type-link" data-case="slate-plaque-10x10">Slate Plaque 10x10cm</a>
                <a href="#" class="product-type-link" data-case="slate-plaque-15x15">Slate Plaque 15x15cm</a>
                <a href="#" class="product-type-link" data-case="slate-plaque-20x30">Slate Plaque 20x30cm</a>
                <a href="#" class="product-type-link" data-case="slate-plaque-heart-10x10">Slate Plaque Heart 10x10cm</a>
                <a href="#" class="product-type-link" data-case="slate-plaque-heart-25x25">Slate Plaque Heart 25x25cm</a>
            </div>

            <!-- AirPods Cases Type Selection -->
            <div id="airpods-cases-types" class="product-type-container">
                <a href="#" class="product-type-link" data-case="airpods-1-2">AirPods 1 / 2</a>
                <a href="#" class="product-type-link" data-case="airpods-3">AirPods 3</a>
                <a href="#" class="product-type-link" data-case="airpods-4">AirPods 4</a>
                <a href="#" class="product-type-link" data-case="airpods-pro">AirPods Pro</a>
                <a href="#" class="product-type-link" data-case="airpods-pro-2">AirPods Pro 2</a>
            </div>

            <!-- T-Shirts Type Selection -->
            <div id="tshirts-types" class="product-type-container">
                <a href="#" class="product-type-link" data-case="tshirt-unisex">Unisex T-Shirt</a>
            </div>

            <!-- Bags Type Selection -->
            <div id="bags-types" class="product-type-container">
                <a href="#" class="product-type-link" data-case="makeup-bag-s">Makeup Bag S</a>
                <a href="#" class="product-type-link" data-case="makeup-bag-m">Makeup Bag M</a>
                <a href="#" class="product-type-link" data-case="makeup-bag-l">Makeup Bag L</a>
            </div>

            <!-- Plaques Stand Selection -->
            <div id="plaques-stand-selection" class="color-size-container">
                <div class="stand-option" data-stand="paw">Paw</div>
                <div class="stand-option" data-stand="heart">Heart</div>
                <div class="stand-option" data-stand="fold">Fold</div>
            </div>

            <!-- T-Shirt Color Selection -->
            <div id="tshirt-color-selection" class="color-size-container">
                <div class="color-option" data-color="black">
                    <span class="color-preview" style="background-color: #000;"></span>
                    Black
                </div>
                <div class="color-option" data-color="white">
                    <span class="color-preview" style="background-color: #fff;"></span>
                    White
                </div>
                <div class="color-option" data-color="melange">
                    <span class="color-preview" style="background-color: #ccc;"></span>
                    Melange
                </div>
                <div class="color-option" data-color="navy">
                    <span class="color-preview" style="background-color: #001f3f;"></span>
                    Navy
                </div>
                <div class="color-option" data-color="fuchsia-pink">
                    <span class="color-preview" style="background-color: #ff66b2;"></span>
                    Fuchsia Pink
                </div>
                <div class="color-option" data-color="dark-heather">
                    <span class="color-preview" style="background-color: #616161;"></span>
                    Dark Heather
                </div>
                <div class="color-option" data-color="military-green">
                    <span class="color-preview" style="background-color: #4b5320;"></span>
                    Military Green
                </div>
                <div class="color-option" data-color="light-royal-blue">
                    <span class="color-preview" style="background-color: #5d8aa8;"></span>
                    Light Royal Blue
                </div>
            </div>

            <!-- Bag Color and Size Selection -->
            <div id="bag-color-selection" class="color-size-container">
                <div class="color-option" data-color="black">
                    <span class="color-preview" style="background-color: #000;"></span>
                    Black
                </div>
                <div class="color-option" data-color="navy">
                    <span class="color-preview" style="background-color: #001f3f;"></span>
                    Navy
                </div>
                <div class="color-option" data-color="natural">
                    <span class="color-preview" style="background-color: #f5f5dc;"></span>
                    Natural
                </div>
            </div>
        </section>
        
        <!-- Controls Section (initially hidden) -->
        <div id="controls">
            <div class="controls-row">
                <div class="file-upload-wrapper">
                    <input type="file" id="image-upload" accept="image/png">
                    <button class="file-upload-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11 15H13V8H16L12 3L8 8H11V15Z" fill="currentColor"/>
                            <path d="M20 18H4V11H2V18C2 19.103 2.897 20 4 20H20C21.103 20 22 19.103 22 18V11H20V18Z" fill="currentColor"/>
                        </svg>
                        Upload Design
                    </button>
                    <button id="remove-btn">Ã—</button>
                </div>
            </div>
            <div class="upload-requirements">
                For best results, upload a PNG file with dimensions 750x1590 pixels at 300 PPI
            </div>
            <div class="controls-row">
                <button id="download-btn" disabled>Download Main Mockup</button>
                <button id="download-zip-btn" disabled>Download Selected Views</button>
            </div>
        </div>
        
        <!-- Main Mockup Container (initially hidden) -->
        <div style="text-align: center; width: 100%;">
            <div id="main-mockup-container">
                <img class="phone-case-bg" src="mockups/optimized/samsung-tpu-back-main.png" data-fullres="mockups/originals/samsung-tpu-back-main.png">
                <div class="design-area">
                    <img class="user-design" src="" alt="" data-x="48.5" data-y="48.5" data-scale="98" data-rotation="0">
                </div>
                <img class="phone-case-overlay" src="mockups/optimized/samsung-tpu-overlay-main.png" data-fullres="mockups/originals/samsung-tpu-overlay-main.png">
            </div>
        </div>
        
        <!-- Secondary Mockups Grid (initially hidden) -->
        <div class="grid-wrapper">
            <div class="grid-container">
                <!-- Grid items will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Other Product Sections (initially hidden) -->
        <div id="plaques" class="product-section">
            <div class="coming-soon">
                <h2>Plaque Mockups</h2>
                <p>Select a plaque type from the options above to see mockups.</p>
            </div>
        </div>
        
        <div id="airpods-cases" class="product-section">
            <div class="coming-soon">
                <h2>AirPods Case Mockups</h2>
                <p>Select an AirPods case type from the options above to see mockups.</p>
            </div>
        </div>
        
        <div id="tshirts" class="product-section">
            <div class="coming-soon">
                <h2>T-Shirt Mockups</h2>
                <p>Select a color from the options above to see mockups.</p>
            </div>
        </div>
        
        <div id="bags" class="product-section">
            <div class="coming-soon">
                <h2>Bag Mockups</h2>
                <p>Select a bag type and color from the options above to see mockups.</p>
            </div>
        </div>
    </main>
    
    <!-- Loading Overlay -->
    <div class="loading">
        <div class="spinner"></div>
        <div>Generating your mockups...</div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script>
    // DOM Elements
    const imageUpload = document.getElementById('image-upload');
    const downloadBtn = document.getElementById('download-btn');
    const downloadZipBtn = document.getElementById('download-zip-btn');
    const productCategoryLinks = document.querySelectorAll('.product-category-link');
    const productTypeLinks = document.querySelectorAll('.product-type-link');
    const loadingElement = document.querySelector('.loading');
    const removeBtn = document.getElementById('remove-btn');
    const mainMockupContainer = document.getElementById('main-mockup-container');
    const gridWrapper = document.querySelector('.grid-wrapper');
    const controlsSection = document.getElementById('controls');
    const phoneCasesTypes = document.getElementById('phone-cases-types');
    const plaquesTypes = document.getElementById('plaques-types');
    const airpodsCasesTypes = document.getElementById('airpods-cases-types');
    const tshirtsTypes = document.getElementById('tshirts-types');
    const bagsTypes = document.getElementById('bags-types');
    const plaquesStandSelection = document.getElementById('plaques-stand-selection');
    const tshirtColorSelection = document.getElementById('tshirt-color-selection');
    const bagColorSelection = document.getElementById('bag-color-selection');
    const gridContainer = document.querySelector('.grid-container');
    
    // State variables
    let uploadedImage = new Image();
    const mockupCache = new Map();
    let currentCaseType = 'samsung-tpu';
    let currentStandType = 'paw';
    let currentTshirtColor = 'black';
    let currentBagColor = 'black';

    // Mockup data structure for all products
    const mockupData = {
        // Phone Cases (existing data)
        'samsung-tpu': {
            name: "Samsung TPU Case",
            main: {
                bg: 'mockups/optimized/samsung-tpu-back-main.png',
                overlay: 'mockups/optimized/samsung-tpu-overlay-main.png',
                fullresBg: 'mockups/originals/samsung-tpu-back-main.png',
                fullresOverlay: 'mockups/originals/samsung-tpu-overlay-main.png',
                designX: 48.5,
                designY: 48.5,
                designScale: 98,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/optimized/samsung-tpu-view1.png', overlay: 'mockups/optimized/samsung-tpu-view1-overlay.png', fullresBg: 'mockups/originals/samsung-tpu-view1.png', fullresOverlay: 'mockups/originals/samsung-tpu-view1-overlay.png', designX: 47, designY: 50, designScale: 54, designRotation: 0 },
                // ... (keep existing views)
            ]
        },
        // ... (keep other existing phone cases)

        // Plaques
        'slate-plaque-10x10': {
            name: "Slate Plaque 10x10cm",
            main: {
                bg: 'mockups/plaques/slate-10x10-main.png',
                overlay: 'mockups/plaques/slate-10x10-overlay.png',
                fullresBg: 'mockups/plaques/originals/slate-10x10-main.png',
                fullresOverlay: 'mockups/plaques/originals/slate-10x10-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/plaques/slate-10x10-view1.png', overlay: 'mockups/plaques/slate-10x10-view1-overlay.png', fullresBg: 'mockups/plaques/originals/slate-10x10-view1.png', fullresOverlay: 'mockups/plaques/originals/slate-10x10-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                { id: 2, bg: 'mockups/plaques/slate-10x10-view2.png', overlay: 'mockups/plaques/slate-10x10-view2-overlay.png', fullresBg: 'mockups/plaques/originals/slate-10x10-view2.png', fullresOverlay: 'mockups/plaques/originals/slate-10x10-view2-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },
        'slate-plaque-15x15': {
            name: "Slate Plaque 15x15cm",
            main: {
                bg: 'mockups/plaques/slate-15x15-main.png',
                overlay: 'mockups/plaques/slate-15x15-overlay.png',
                fullresBg: 'mockups/plaques/originals/slate-15x15-main.png',
                fullresOverlay: 'mockups/plaques/originals/slate-15x15-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/plaques/slate-15x15-view1.png', overlay: 'mockups/plaques/slate-15x15-view1-overlay.png', fullresBg: 'mockups/plaques/originals/slate-15x15-view1.png', fullresOverlay: 'mockups/plaques/originals/slate-15x15-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },
        'slate-plaque-20x30': {
            name: "Slate Plaque 20x30cm",
            main: {
                bg: 'mockups/plaques/slate-20x30-main.png',
                overlay: 'mockups/plaques/slate-20x30-overlay.png',
                fullresBg: 'mockups/plaques/originals/slate-20x30-main.png',
                fullresOverlay: 'mockups/plaques/originals/slate-20x30-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/plaques/slate-20x30-view1.png', overlay: 'mockups/plaques/slate-20x30-view1-overlay.png', fullresBg: 'mockups/plaques/originals/slate-20x30-view1.png', fullresOverlay: 'mockups/plaques/originals/slate-20x30-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },
        'slate-plaque-heart-10x10': {
            name: "Slate Plaque Heart 10x10cm",
            main: {
                bg: 'mockups/plaques/slate-heart-10x10-main.png',
                overlay: 'mockups/plaques/slate-heart-10x10-overlay.png',
                fullresBg: 'mockups/plaques/originals/slate-heart-10x10-main.png',
                fullresOverlay: 'mockups/plaques/originals/slate-heart-10x10-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/plaques/slate-heart-10x10-view1.png', overlay: 'mockups/plaques/slate-heart-10x10-view1-overlay.png', fullresBg: 'mockups/plaques/originals/slate-heart-10x10-view1.png', fullresOverlay: 'mockups/plaques/originals/slate-heart-10x10-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },
        'slate-plaque-heart-25x25': {
            name: "Slate Plaque Heart 25x25cm",
            main: {
                bg: 'mockups/plaques/slate-heart-25x25-main.png',
                overlay: 'mockups/plaques/slate-heart-25x25-overlay.png',
                fullresBg: 'mockups/plaques/originals/slate-heart-25x25-main.png',
                fullresOverlay: 'mockups/plaques/originals/slate-heart-25x25-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/plaques/slate-heart-25x25-view1.png', overlay: 'mockups/plaques/slate-heart-25x25-view1-overlay.png', fullresBg: 'mockups/plaques/originals/slate-heart-25x25-view1.png', fullresOverlay: 'mockups/plaques/originals/slate-heart-25x25-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },
        'acrylic-block-10x10': {
            name: "Acrylic Block 10x10cm",
            main: {
                bg: 'mockups/plaques/acrylic-10x10-main.png',
                overlay: 'mockups/plaques/acrylic-10x10-overlay.png',
                fullresBg: 'mockups/plaques/originals/acrylic-10x10-main.png',
                fullresOverlay: 'mockups/plaques/originals/acrylic-10x10-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/plaques/acrylic-10x10-view1.png', overlay: 'mockups/plaques/acrylic-10x10-view1-overlay.png', fullresBg: 'mockups/plaques/originals/acrylic-10x10-view1.png', fullresOverlay: 'mockups/plaques/originals/acrylic-10x10-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },

        // AirPods Cases
        'airpods-1-2': {
            name: "AirPods 1 / 2 Case",
            main: {
                bg: 'mockups/airpods/airpods-1-2-main.png',
                overlay: 'mockups/airpods/airpods-1-2-overlay.png',
                fullresBg: 'mockups/airpods/originals/airpods-1-2-main.png',
                fullresOverlay: 'mockups/airpods/originals/airpods-1-2-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/airpods/airpods-1-2-view1.png', overlay: 'mockups/airpods/airpods-1-2-view1-overlay.png', fullresBg: 'mockups/airpods/originals/airpods-1-2-view1.png', fullresOverlay: 'mockups/airpods/originals/airpods-1-2-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },
        'airpods-3': {
            name: "AirPods 3 Case",
            main: {
                bg: 'mockups/airpods/airpods-3-main.png',
                overlay: 'mockups/airpods/airpods-3-overlay.png',
                fullresBg: 'mockups/airpods/originals/airpods-3-main.png',
                fullresOverlay: 'mockups/airpods/originals/airpods-3-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/airpods/airpods-3-view1.png', overlay: 'mockups/airpods/airpods-3-view1-overlay.png', fullresBg: 'mockups/airpods/originals/airpods-3-view1.png', fullresOverlay: 'mockups/airpods/originals/airpods-3-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },
        'airpods-4': {
            name: "AirPods 4 Case",
            main: {
                bg: 'mockups/airpods/airpods-4-main.png',
                overlay: 'mockups/airpods/airpods-4-overlay.png',
                fullresBg: 'mockups/airpods/originals/airpods-4-main.png',
                fullresOverlay: 'mockups/airpods/originals/airpods-4-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/airpods/airpods-4-view1.png', overlay: 'mockups/airpods/airpods-4-view1-overlay.png', fullresBg: 'mockups/airpods/originals/airpods-4-view1.png', fullresOverlay: 'mockups/airpods/originals/airpods-4-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },
        'airpods-pro': {
            name: "AirPods Pro Case",
            main: {
                bg: 'mockups/airpods/airpods-pro-main.png',
                overlay: 'mockups/airpods/airpods-pro-overlay.png',
                fullresBg: 'mockups/airpods/originals/airpods-pro-main.png',
                fullresOverlay: 'mockups/airpods/originals/airpods-pro-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/airpods/airpods-pro-view1.png', overlay: 'mockups/airpods/airpods-pro-view1-overlay.png', fullresBg: 'mockups/airpods/originals/airpods-pro-view1.png', fullresOverlay: 'mockups/airpods/originals/airpods-pro-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },
        'airpods-pro-2': {
            name: "AirPods Pro 2 Case",
            main: {
                bg: 'mockups/airpods/airpods-pro-2-main.png',
                overlay: 'mockups/airpods/airpods-pro-2-overlay.png',
                fullresBg: 'mockups/airpods/originals/airpods-pro-2-main.png',
                fullresOverlay: 'mockups/airpods/originals/airpods-pro-2-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/airpods/airpods-pro-2-view1.png', overlay: 'mockups/airpods/airpods-pro-2-view1-overlay.png', fullresBg: 'mockups/airpods/originals/airpods-pro-2-view1.png', fullresOverlay: 'mockups/airpods/originals/airpods-pro-2-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views
            ]
        },

        // T-Shirts
        'tshirt-classic': {
            name: "Classic T-Shirt",
            main: {
                bg: 'mockups/tshirts/black-main.png',
                overlay: 'mockups/tshirts/black-overlay.png',
                fullresBg: 'mockups/tshirts/originals/black-main.png',
                fullresOverlay: 'mockups/tshirts/originals/black-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/tshirts/black-view1.png', overlay: 'mockups/tshirts/black-view1-overlay.png', fullresBg: 'mockups/tshirts/originals/black-view1.png', fullresOverlay: 'mockups/tshirts/originals/black-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views (same for all colors)
            ]
        },

        // Bags
        'cotton-bag-50x75': {
            name: "Cotton Bag 50x75cm",
            main: {
                bg: 'mockups/bags/cotton-black-main.png',
                overlay: 'mockups/bags/cotton-black-overlay.png',
                fullresBg: 'mockups/bags/originals/cotton-black-main.png',
                fullresOverlay: 'mockups/bags/originals/cotton-black-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/bags/cotton-black-view1.png', overlay: 'mockups/bags/cotton-black-view1-overlay.png', fullresBg: 'mockups/bags/originals/cotton-black-view1.png', fullresOverlay: 'mockups/bags/originals/cotton-black-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views (same for all colors)
            ]
        },
        'makeup-bag-s': {
            name: "Makeup Bag S",
            main: {
                bg: 'mockups/bags/makeup-black-s-main.png',
                overlay: 'mockups/bags/makeup-black-s-overlay.png',
                fullresBg: 'mockups/bags/originals/makeup-black-s-main.png',
                fullresOverlay: 'mockups/bags/originals/makeup-black-s-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/bags/makeup-black-s-view1.png', overlay: 'mockups/bags/makeup-black-s-view1-overlay.png', fullresBg: 'mockups/bags/originals/makeup-black-s-view1.png', fullresOverlay: 'mockups/bags/originals/makeup-black-s-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views (same for all colors)
            ]
        },
        'makeup-bag-m': {
            name: "Makeup Bag M",
            main: {
                bg: 'mockups/bags/makeup-black-m-main.png',
                overlay: 'mockups/bags/makeup-black-m-overlay.png',
                fullresBg: 'mockups/bags/originals/makeup-black-m-main.png',
                fullresOverlay: 'mockups/bags/originals/makeup-black-m-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/bags/makeup-black-m-view1.png', overlay: 'mockups/bags/makeup-black-m-view1-overlay.png', fullresBg: 'mockups/bags/originals/makeup-black-m-view1.png', fullresOverlay: 'mockups/bags/originals/makeup-black-m-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views (same for all colors)
            ]
        },
        'makeup-bag-l': {
            name: "Makeup Bag L",
            main: {
                bg: 'mockups/bags/makeup-black-l-main.png',
                overlay: 'mockups/bags/makeup-black-l-overlay.png',
                fullresBg: 'mockups/bags/originals/makeup-black-l-main.png',
                fullresOverlay: 'mockups/bags/originals/makeup-black-l-overlay.png',
                designX: 50,
                designY: 50,
                designScale: 90,
                designRotation: 0
            },
            views: [
                { id: 1, bg: 'mockups/bags/makeup-black-l-view1.png', overlay: 'mockups/bags/makeup-black-l-view1-overlay.png', fullresBg: 'mockups/bags/originals/makeup-black-l-view1.png', fullresOverlay: 'mockups/bags/originals/makeup-black-l-view1-overlay.png', designX: 50, designY: 50, designScale: 90, designRotation: 0 },
                // ... up to 10 views (same for all colors)
            ]
        }
    };

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Set up event listeners
        setupEventListeners();
    });

    // Set up all event listeners
    function setupEventListeners() {
        // Product category selection
        productCategoryLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active category link
                productCategoryLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                const category = this.dataset.category;
                
                // Show/hide product type selection based on category
                phoneCasesTypes.style.display = 'none';
                plaquesTypes.style.display = 'none';
                airpodsCasesTypes.style.display = 'none';
                tshirtsTypes.style.display = 'none';
                bagsTypes.style.display = 'none';
                plaquesStandSelection.style.display = 'none';
                tshirtColorSelection.style.display = 'none';
                bagColorSelection.style.display = 'none';
                
                if (category === 'phone-cases') {
                    phoneCasesTypes.style.display = 'flex';
                    controlsSection.style.display = 'block';
                    mainMockupContainer.style.display = 'inline-block';
                    gridWrapper.style.display = 'block';
                    
                    // Initialize the grid for the default case type
                    initializeGrid(currentCaseType);
                } 
                else if (category === 'plaques') {
                    plaquesTypes.style.display = 'flex';
                    plaquesStandSelection.style.display = 'flex';
                    controlsSection.style.display = 'block';
                    mainMockupContainer.style.display = 'inline-block';
                    gridWrapper.style.display = 'block';
                    
                    // Initialize with first plaque type
                    currentCaseType = 'slate-plaque-10x10';
                    updateMainMockup(currentCaseType);
                    initializeGrid(currentCaseType);
                }
                else if (category === 'airpods-cases') {
                    airpodsCasesTypes.style.display = 'flex';
                    controlsSection.style.display = 'block';
                    mainMockupContainer.style.display = 'inline-block';
                    gridWrapper.style.display = 'block';
                    
                    // Initialize with first AirPods case type
                    currentCaseType = 'airpods-1-2';
                    updateMainMockup(currentCaseType);
                    initializeGrid(currentCaseType);
                }
                else if (category === 'tshirts') {
                    tshirtsTypes.style.display = 'flex';
                    tshirtColorSelection.style.display = 'flex';
                    controlsSection.style.display = 'block';
                    mainMockupContainer.style.display = 'inline-block';
                    gridWrapper.style.display = 'block';
                    
                    // Initialize with first T-Shirt type and default color
                    currentCaseType = 'tshirt-classic';
                    currentTshirtColor = 'black';
                    updateMainMockup(currentCaseType);
                    initializeGrid(currentCaseType);
                }
                else if (category === 'bags') {
                    bagsTypes.style.display = 'flex';
                    bagColorSelection.style.display = 'flex';
                    controlsSection.style.display = 'block';
                    mainMockupContainer.style.display = 'inline-block';
                    gridWrapper.style.display = 'block';
                    
                    // Initialize with first bag type and default color
                    currentCaseType = 'cotton-bag-50x75';
                    currentBagColor = 'black';
                    updateMainMockup(currentCaseType);
                    initializeGrid(currentCaseType);
                }
                
                // Show selected product section
                document.querySelectorAll('.product-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById(category).classList.add('active');
            });
        });

        // Product type selection (for all product types)
        productTypeLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active type link
                const container = this.closest('.product-type-container');
                container.querySelectorAll('.product-type-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                currentCaseType = this.dataset.case;
                
                // Update main mockup
                updateMainMockup(currentCaseType);
                
                // Update grid for the selected case type
                initializeGrid(currentCaseType);
                
                // Update design positions if an image is already uploaded
                if (uploadedImage.src) {
                    document.querySelectorAll('.user-design').forEach(design => {
                        if (design.src) {
                            design.style.display = 'block';
                            updateDesignPosition(design);
                        }
                    });
                }
            });
        });

        // Plaque stand selection
        plaquesStandSelection.querySelectorAll('.stand-option').forEach(option => {
            option.addEventListener('click', function() {
                plaquesStandSelection.querySelectorAll('.stand-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                currentStandType = this.dataset.stand;
                
                // Update mockups with new stand type
                updateMainMockup(currentCaseType);
                initializeGrid(currentCaseType);
            });
        });

        // T-Shirt color selection
        tshirtColorSelection.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', function() {
                tshirtColorSelection.querySelectorAll('.color-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                currentTshirtColor = this.dataset.color;
                
                // Update mockups with new color
                updateMainMockup(currentCaseType);
                initializeGrid(currentCaseType);
            });
        });

        // Bag color selection
        bagColorSelection.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', function() {
                bagColorSelection.querySelectorAll('.color-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                currentBagColor = this.dataset.color;
                
                // Update mockups with new color
                updateMainMockup(currentCaseType);
                initializeGrid(currentCaseType);
            });
        });

        // Image upload handler
        imageUpload.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file type
            if (!file.type.match('image/png')) {
                alert('Please upload a PNG file');
                return;
            }
            
            showLoading("Loading your design...");
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const testImage = new Image();
                testImage.onload = function() {
                    // Check image dimensions
                    if (this.width !== 750 || this.height !== 1590) {
                        hideLoading();
                        alert('Image dimensions should be 750x1590 pixels');
                        return;
                    }
                    
                    // Update all designs with the new image
                    document.querySelectorAll('.user-design').forEach(design => {
                        design.src = e.target.result;
                        design.style.display = 'block';
                        updateDesignPosition(design);
                    });
                    
                    uploadedImage.src = e.target.result;
                    mockupCache.clear();
                    removeBtn.style.display = 'block';
                    
                    // Enable download buttons
                    downloadBtn.disabled = false;
                    downloadZipBtn.disabled = false;
                    
                    hideLoading();
                };
                testImage.onerror = function() {
                    hideLoading();
                    alert("Error: The image couldn't be loaded. Please try another file.");
                };
                testImage.src = e.target.result;
            };
            reader.onerror = function() {
                hideLoading();
                alert("Error reading file. Please try again.");
            };
            reader.readAsDataURL(file);
        });

        // Remove button handler
        removeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            document.querySelectorAll('.user-design').forEach(design => {
                design.src = '';
                design.style.display = 'none';
            });
            
            uploadedImage.src = '';
            imageUpload.value = '';
            mockupCache.clear();
            removeBtn.style.display = 'none';
            
            // Disable download buttons
            downloadBtn.disabled = true;
            downloadZipBtn.disabled = true;
        });
        
        // Download main mockup
        downloadBtn.addEventListener('click', async function() {
            if (!uploadedImage.src) {
                alert('Please upload an image first');
                return;
            }

            showLoading("Generating main mockup...");
            
            try {
                const canvas = await generateMockupImage(mainMockupContainer);
                downloadBlob(await canvasToBlob(canvas), 'main-mockup.png');
            } catch (error) {
                console.error("Error generating mockup:", error);
                alert("Error generating mockup. Please try again.");
            } finally {
                hideLoading();
            }
        });

        // Download selected mockups as ZIP
        downloadZipBtn.addEventListener('click', async function() {
            if (!uploadedImage.src) {
                alert('Please upload an image first');
                return;
            }

            showLoading("Preparing ZIP file...");
            
            try {
                const checkedItems = Array.from(document.querySelectorAll('.carousel-checkbox:checked'));
                
                if (checkedItems.length === 0) {
                    alert('Please select at least one mockup view to download');
                    return;
                }

                const zip = new JSZip();
                const caseData = mockupData[currentCaseType];
                const promises = [];
                
                // Add main mockup to ZIP
                promises.push((async () => {
                    showLoading("Generating main mockup...");
                    const mainCanvas = await generateMockupImage(mainMockupContainer);
                    const mainBlob = await canvasToBlob(mainCanvas);
                    zip.file(`${caseData.name.replace(/\s+/g, '-').toLowerCase()}-main.png`, mainBlob);
                })());
                
                // Process selected grid items
                for (const item of checkedItems) {
                    const viewNumber = item.dataset.view;
                    const viewData = caseData.views.find(v => v.id == viewNumber);
                    
                    if (!viewData) continue;
                    
                    promises.push((async () => {
                        showLoading(`Generating view ${viewNumber}...`);
                        const mockupContainer = document.querySelector(`.grid-item[data-view="${viewNumber}"] .secondary-mockup`);
                        const canvas = await generateMockupImage(mockupContainer);
                        const blob = await canvasToBlob(canvas);
                        zip.file(`${caseData.name.replace(/\s+/g, '-').toLowerCase()}-view-${viewNumber}.png`, blob);
                    })());
                }
                
                // Wait for all mockups to be generated
                await Promise.all(promises);
                
                // Generate and download ZIP
                showLoading("Creating ZIP file...");
                const content = await zip.generateAsync({ type: 'blob' });
                downloadBlob(content, `${caseData.name.replace(/\s+/g, '-').toLowerCase()}-mockups.zip`);
                
            } catch (error) {
                console.error("Error generating ZIP:", error);
                alert("Error generating ZIP file. Please try again.");
            } finally {
                hideLoading();
            }
        });
        
        // Make grid items clickable to toggle selection
        document.addEventListener('click', function(e) {
            const gridItem = e.target.closest('.grid-item');
            if (gridItem) {
                const checkbox = gridItem.querySelector('.carousel-checkbox');
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                    e.preventDefault();
                }
            }
        });
    }

    // Initialize grid for a specific case type
    function initializeGrid(caseType) {
        gridContainer.innerHTML = '';
        
        const caseData = mockupData[caseType];
        if (!caseData) return;
        
        caseData.views.forEach(view => {
            const gridItem = document.createElement('div');
            gridItem.className = 'grid-item';
            gridItem.dataset.view = view.id;
            
            // Determine the correct image paths based on product type and selections
            let bgPath = view.bg;
            let overlayPath = view.overlay;
            let fullresBgPath = view.fullresBg;
            let fullresOverlayPath = view.fullresOverlay;
            
            // Handle plaques with different stands
            if (caseType.includes('plaque')) {
                bgPath = bgPath.replace('slate-', `slate-${currentStandType}-`);
                overlayPath = overlayPath.replace('slate-', `slate-${currentStandType}-`);
                fullresBgPath = fullresBgPath.replace('slate-', `slate-${currentStandType}-`);
                fullresOverlayPath = fullresOverlayPath.replace('slate-', `slate-${currentStandType}-`);
            }
            // Handle T-Shirt colors
            else if (caseType.includes('tshirt')) {
                bgPath = view.bg.replace('black', currentTshirtColor);
                overlayPath = view.overlay.replace('black', currentTshirtColor);
                fullresBgPath = view.fullresBg.replace('black', currentTshirtColor);
                fullresOverlayPath = view.fullresOverlay.replace('black', currentTshirtColor);
            }
            // Handle bag colors
            else if (caseType.includes('bag')) {
                if (caseType.includes('cotton')) {
                    bgPath = view.bg.replace('black', currentBagColor);
                    overlayPath = view.overlay.replace('black', currentBagColor);
                    fullresBgPath = view.fullresBg.replace('black', currentBagColor);
                    fullresOverlayPath = view.fullresOverlay.replace('black', currentBagColor);
                } else if (caseType.includes('makeup')) {
                    const size = caseType.split('-').pop();
                    bgPath = view.bg.replace('black', currentBagColor).replace('-s-', `-${size}-`);
                    overlayPath = view.overlay.replace('black', currentBagColor).replace('-s-', `-${size}-`);
                    fullresBgPath = view.fullresBg.replace('black', currentBagColor).replace('-s-', `-${size}-`);
                    fullresOverlayPath = view.fullresOverlay.replace('black', currentBagColor).replace('-s-', `-${size}-`);
                }
            }
            
            gridItem.innerHTML = `
                <div class="secondary-mockup">
                    <input type="checkbox" class="carousel-checkbox" data-view="${view.id}">
                    <img class="${getImageClass(caseType)}-bg" src="${bgPath}" data-fullres="${fullresBgPath}">
                    <div class="design-area">
                        <img class="user-design" src="${uploadedImage.src || ''}" alt="" 
                             data-x="${view.designX}" data-y="${view.designY}" 
                             data-scale="${view.designScale}" data-rotation="${view.designRotation}"
                             style="display: ${uploadedImage.src ? 'block' : 'none'}">
                    </div>
                    <img class="${getImageClass(caseType)}-overlay" src="${overlayPath}" data-fullres="${fullresOverlayPath}">
                </div>
                <div class="mockup-label">View ${view.id}</div>
            `;
            
            gridContainer.appendChild(gridItem);
            
            // Update design position if image is already uploaded
            if (uploadedImage.src) {
                const design = gridItem.querySelector('.user-design');
                updateDesignPosition(design);
            }
        });
    }

    // Helper function to get the appropriate image class based on product type
    function getImageClass(caseType) {
        if (caseType.includes('phone') || caseType.includes('pixel') || caseType.includes('iphone')) {
            return 'phone-case';
        } else if (caseType.includes('plaque')) {
            return 'plaque';
        } else if (caseType.includes('airpods')) {
            return 'airpods';
        } else if (caseType.includes('tshirt')) {
            return 'tshirt';
        } else if (caseType.includes('bag')) {
            return 'bag';
        }
        return 'phone-case'; // default
    }

    // Update main mockup for a specific case type
    function updateMainMockup(caseType) {
        const caseData = mockupData[caseType];
        if (!caseData) return;
        
        const mainMockup = caseData.main;
        
        // Determine the correct image paths based on product type and selections
        let bgPath = mainMockup.bg;
        let overlayPath = mainMockup.overlay;
        let fullresBgPath = mainMockup.fullresBg;
        let fullresOverlayPath = mainMockup.fullresOverlay;
        
        // Handle plaques with different stands
        if (caseType.includes('plaque')) {
            bgPath = bgPath.replace('slate-', `slate-${currentStandType}-`);
            overlayPath = overlayPath.replace('slate-', `slate-${currentStandType}-`);
            fullresBgPath = fullresBgPath.replace('slate-', `slate-${currentStandType}-`);
            fullresOverlayPath = fullresOverlayPath.replace('slate-', `slate-${currentStandType}-`);
        }
        // Handle T-Shirt colors
        else if (caseType.includes('tshirt')) {
            bgPath = mainMockup.bg.replace('black', currentTshirtColor);
            overlayPath = mainMockup.overlay.replace('black', currentTshirtColor);
            fullresBgPath = mainMockup.fullresBg.replace('black', currentTshirtColor);
            fullresOverlayPath = mainMockup.fullresOverlay.replace('black', currentTshirtColor);
        }
        // Handle bag colors
        else if (caseType.includes('bag')) {
            if (caseType.includes('cotton')) {
                bgPath = mainMockup.bg.replace('black', currentBagColor);
                overlayPath = mainMockup.overlay.replace('black', currentBagColor);
                fullresBgPath = mainMockup.fullresBg.replace('black', currentBagColor);
                fullresOverlayPath = mainMockup.fullresOverlay.replace('black', currentBagColor);
            } else if (caseType.includes('makeup')) {
                const size = caseType.split('-').pop();
                bgPath = mainMockup.bg.replace('black', currentBagColor).replace('-s-', `-${size}-`);
                overlayPath = mainMockup.overlay.replace('black', currentBagColor).replace('-s-', `-${size}-`);
                fullresBgPath = mainMockup.fullresBg.replace('black', currentBagColor).replace('-s-', `-${size}-`);
                fullresOverlayPath = mainMockup.fullresOverlay.replace('black', currentBagColor).replace('-s-', `-${size}-`);
            }
        }
        
        // Clear the mockup container and recreate with correct classes
        mainMockupContainer.innerHTML = '';
        
        const imageClass = getImageClass(caseType);
        const bgImg = document.createElement('img');
        bgImg.className = `${imageClass}-bg`;
        bgImg.src = bgPath;
        bgImg.dataset.fullres = fullresBgPath;
        
        const designArea = document.createElement('div');
        designArea.className = 'design-area';
        const designImg = document.createElement('img');
        designImg.className = 'user-design';
        designImg.alt = '';
        designImg.dataset.x = mainMockup.designX;
        designImg.dataset.y = mainMockup.designY;
        designImg.dataset.scale = mainMockup.designScale;
        designImg.dataset.rotation = mainMockup.designRotation;
        designImg.style.display = uploadedImage.src ? 'block' : 'none';
        if (uploadedImage.src) {
            designImg.src = uploadedImage.src;
        }
        designArea.appendChild(designImg);
        
        const overlayImg = document.createElement('img');
        overlayImg.className = `${imageClass}-overlay`;
        overlayImg.src = overlayPath;
        overlayImg.dataset.fullres = fullresOverlayPath;
        
        mainMockupContainer.appendChild(bgImg);
        mainMockupContainer.appendChild(designArea);
        mainMockupContainer.appendChild(overlayImg);
        
        // Update design position if image is already uploaded
        if (uploadedImage.src) {
            updateDesignPosition(designImg);
        }
    }

    // Function to update design position based on data attributes
    function updateDesignPosition(designElement) {
        const x = parseFloat(designElement.dataset.x) || 50;
        const y = parseFloat(designElement.dataset.y) || 50;
        const scale = parseFloat(designElement.dataset.scale) || 100;
        const rotation = parseFloat(designElement.dataset.rotation) || 0;
        
        designElement.style.top = `${y}%`;
        designElement.style.left = `${x}%`;
        designElement.style.transform = `translate(-50%, -50%) scale(${scale/100}) rotate(${rotation}deg)`;
    }

    // Generate mockup image with caching
    async function generateMockupImage(container) {
        const cacheKey = `${container.id}-${uploadedImage.src}`;
        if (mockupCache.has(cacheKey)) {
            return mockupCache.get(cacheKey);
        }

        showLoading("Generating mockup...");
        
        try {
            const canvas = document.createElement('canvas');
            canvas.width = 2000;
            canvas.height = 2000;
            const ctx = canvas.getContext('2d');

            // Load high-res originals for download
            const bgElement = container.querySelector('.phone-case-bg, .tshirt-bg, .bag-bg, .plaque-bg, .airpods-bg');
            const overlayElement = container.querySelector('.phone-case-overlay, .tshirt-overlay, .bag-overlay, .plaque-overlay, .airpods-overlay');
            
            if (!bgElement || !overlayElement) {
                throw new Error("Could not find required elements for mockup generation");
            }
            
            const bgSrc = bgElement.dataset.fullres;
            const overlaySrc = overlayElement.dataset.fullres;
            
            const [bg, overlay] = await Promise.all([
                loadImage(bgSrc),
                loadImage(overlaySrc)
            ]);

            // Draw background
            ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);
            
            // Draw design if uploaded
            if (uploadedImage.src) {
                try {
                    const design = await loadImage(uploadedImage.src);
                    const designElement = container.querySelector('.user-design');
                    const x = parseFloat(designElement.dataset.x) || 50;
                    const y = parseFloat(designElement.dataset.y) || 50;
                    const scale = parseFloat(designElement.dataset.scale) || 100;
                    const rotation = parseFloat(designElement.dataset.rotation) || 0;
                    
                    const designScale = Math.min(
                        canvas.width / design.width,
                        canvas.height / design.height
                    ) * (scale / 100);
                    
                    const width = design.width * designScale;
                    const height = design.height * designScale;
                    
                    // Calculate position based on percentage values
                    const posX = (canvas.width * x / 100) - (width / 2);
                    const posY = (canvas.height * y / 100) - (height / 2);
                    
                    // Save context, rotate, then draw image
                    ctx.save();
                    ctx.translate(posX + width/2, posY + height/2);
                    ctx.rotate(rotation * Math.PI / 180);
                    ctx.drawImage(design, -width/2, -height/2, width, height);
                    ctx.restore();
                } catch (e) {
                    console.warn("Design image not loaded:", e.message);
                }
            }
            
            // Draw overlay
            ctx.drawImage(overlay, 0, 0, canvas.width, canvas.height);
            
            mockupCache.set(cacheKey, canvas);
            return canvas;
        } finally {
            hideLoading();
        }
    }

    // Helper functions
    function loadImage(src) {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.onload = () => resolve(img);
            img.onerror = () => reject(new Error(`Failed to load image: ${src}`));
            img.src = src;
        });
    }
    
    function canvasToBlob(canvas) {
        return new Promise(resolve => {
            canvas.toBlob(blob => {
                resolve(blob);
            }, 'image/png', 0.95);
        });
    }
    
    function downloadBlob(blob, filename) {
        const link = document.createElement('a');
        link.download = filename;
        link.href = URL.createObjectURL(blob);
        document.body.appendChild(link);
        link.click();
        setTimeout(() => {
            URL.revokeObjectURL(link.href);
            link.remove();
        }, 100);
    }
    
    function showLoading(message = "Processing...") {
        loadingElement.innerHTML = `
            <div class="spinner"></div>
            <div>${message}</div>
        `;
        loadingElement.style.display = 'flex';
    }
    
    function hideLoading() {
        loadingElement.style.display = 'none';
    }
</script>
</body>
</html>
